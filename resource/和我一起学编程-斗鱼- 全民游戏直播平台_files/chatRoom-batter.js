+(function(b){var d=[],i=3000,e=500,j=true,f=function(){};function m(n){var p=new Date().getTime(),o={id:p,time:p};n=n||{};o.data=$.isFunction(n.data)?n.data():n.data;o.render=$.isFunction(n.render)?n.render:f;o.destroy=$.isFunction(n.destroy)?n.destroy:f;o.scope=n.scope||window;o.option=n;n.render.call(o.scope,o);d.push(o)}function g(q,o){var n,p;l(function(r,s){if(q===s.id){n=r;return false}});if(n===undefined){return false}p=d[n]=$.extend(true,d[n],o);p.render.call(p.scope,p);return true}function l(p){var o=0,n=d.length;for(;o<n;o++){if(p(o,d[o])===false){break}}}function c(){return d.length}function h(){var o=new Date(),n=[];l(function(p,q){if(!q.time){return true}if(o-q.time<i){n.push(q)}else{q.destroy.call(q.scope,q)}});d=n;return j}function a(){j=true;Helper.interval(h,e,true)}function k(){j=false}b.BatterTimeline={add:m,update:g,each:l,start:a,stop:k,length:c,set:function(n,o){if(n==="timeout"){i=o}else{if(n==="timestep"){e=o}}}}})(window);+(function(o){var d,b,i=navigator.appVersion.indexOf("MSIE")>0||navigator.appVersion.indexOf("Trident/7.0")>0,e=navigator.appVersion.indexOf("MSIE 7.0;")>0,f=navigator.userAgent.indexOf("Firefox")>0,l=5,q={100:7,520:0,1000:1,2333:2,6666:3,10000:4,88888:5,99999:6};function a(){$("#ywbztit").css("right","auto");d=$("#right_col");d=d.length?d:$(".column01 .r");d.css("overflow","hidden");b=$('<div class="batter-box"></div>');d.append(b)}function m(s){return b.find('.batter-item[data-id="'+s+'"]')}function c(u){var s,t=['<div data-id="<%=item.id%>" data-bgcls="<%=item.backClass%>" class="batter-item <%=item.backClass%>">','<span class="i-name"><%=item.name%></span>','<span class="i-send">送出<b><%=item.count%></b>鱼丸</span>','<span class="i-bat <%=item.batterClass%>"></span>','<div class="i-count clearfix">','<div class="nbox clearfix">',"<% for(var j=0; j<item.batterStrs.length; j++) { %>","<% var str = item.batterStrs[j]; %>",'<span class="n n<%=str%>"></span>',"<% } %>","</div>","</div>",'<span class="i-icon"></span>',"</div>"].join("");u.backClass="batter-item-bg-"+u.bgType;u.batterStrs=String(u.batter).split("");s=Helper.template(t);return s({item:u})}function n(t,x){var v,u,y=t.data("bgcls"),s="batter-item-bg-"+x.bgType,w=['<span class="i-name"><%=item.name%></span>','<span class="i-send">送出<b><%=item.count%></b>鱼丸</span>','<span class="i-bat <%=item.batterClass%>"></span>','<div class="i-count clearfix">','<div class="nbox clearfix">',"<% for(var j=0; j<item.batterStrs.length; j++) { %>","<% var str = item.batterStrs[j]; %>",'<span class="n n<%=str%>"></span>',"<% } %>","</div>","</div>",'<span class="i-icon"></span>',].join("");x.batterStrs=String(x.batter).split("");v=Helper.template(w);u=v({item:x});t.removeClass(y).addClass(s).data("bgcls",s);t.html(u)}function p(){if(!b.find(".batter-item").length){b.hide();BatterTimeline.stop();return}b.show();BatterTimeline.start();b.css("top",(d.height()-b.height())/2)}function j(v){if(i){var u="10px",w="-2px";if(e){w="-30px";u="2px;"}v.find(".i-count .nbox").css({zoom:1.3,bottom:u,right:w}).animate({zoom:1,bottom:0,right:0},300,function(){$(this).css({zoom:1,bottom:0,right:0})})}else{var y="-23px",x="9px",t=1.2,s=0.9;if(f){y="-23px";x="-10px";t=1.1;s=0.9}v.find(".i-count .nbox").css({zoom:t,"-moz-transform":"scale("+t+")",bottom:"2px",right:y}).animate({zoom:s,"-moz-transform":"scale("+s+")",bottom:0,right:x},300,function(){$(this).removeAttr("style").addClass("mini")})}}function g(u){var t,v=u.data,s=m(u.id);if(s.length){n(s,v)}else{v.id=u.id;t=c(v);s=$(t).css("left",-d.innerWidth());b.append(s);s.animate({left:0},300)}j(s);p()}function r(t){var s=m(t.id);if(s.length){s.animate({left:d.outerWidth()},function(){$(this).remove();p()})}}function h(s){if(BatterTimeline.length()>=l){return}var t;BatterTimeline.each(function(u,v){if(s.name===v.data.name){t=v.id;return false}});if(t){BatterTimeline.update(t,{time:new Date().getTime(),data:s})}else{BatterTimeline.add({data:s,render:g,destroy:r})}}function k(t){if(!t||t.r==="218"||t.r==="283"||!$.isNumeric(t.hc)||!t.user.nick||!$.isNumeric(t.ms)){return false}var s=parseInt(t.hc,10);if(s<=1||s>9999){return false}return{name:t.user.nick,batter:s,count:t.ms,bgType:q[t.ms]}}o.roomBatterFxRender=function(t){var s=k(t);if(!s){return}h(s)};o.setLiveBatterTarget=function(s){d=$(s)};$(function(){a()})})(window);